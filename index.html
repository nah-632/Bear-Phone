<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دب فون - Bear Phone</title>
    
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; text-align: center; }
        .header { background: #333; color: white; padding: 20px; border-radius: 10px; margin-bottom: 30px; }
        
        /* تنسيق شبكة المنتجات */
        .products-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); 
            gap: 20px; 
            padding: 10px; 
        }

        .product-card { 
            background: white; 
            border-radius: 15px; 
            padding: 15px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
            transition: 0.3s;
        }

        .product-card:hover { transform: translateY(-5px); }
        .product-card img { width: 100%; height: 200px; object-fit: cover; border-radius: 10px; }
        .product-card h3 { margin: 15px 0 10px; color: #333; }
        .product-card .price { color: #e67e22; font-size: 1.2rem; font-weight: bold; margin-bottom: 15px; }
        
        .buy-btn { 
            display: inline-block; 
            background: #25d366; 
            color: white; 
            padding: 10px 20px; 
            text-decoration: none; 
            border-radius: 5px; 
            font-weight: bold; 
        }
    </style>
</head>
<body>

    <div class="header">
        <h1>مرحباً بك في دب فون</h1>
        <p>أحدث إكسسوارات الجوالات بين يديك</p>
    </div>

    <div id="products-container" class="products-grid">
        <p>جاري تحميل المنتجات...</p>
    </div>

    <script>
        async function loadProducts() {
            try {
                // جلب المنتجات من مجلد data/products في مستودعك
                const response = await fetch('https://api.github.com/repos/nah-632/Bear-Phone/contents/data/products');
                if (!response.ok) throw new Error('لا توجد منتجات حالياً');
                
                const files = await response.json();
                const container = document.getElementById('products-container');
                container.innerHTML = ''; 

                for (const file of files) {
                    if (file.name.endsWith('.json')) {
                        const contentResponse = await fetch(file.download_url);
                        const product = await contentResponse.json();
                        
                        // بناء كرت المنتج
                        container.innerHTML += `
                            <div class="product-card">
                                <img src="${product.image}" alt="${product.title}">
                                <h3>${product.title}</h3>
                                <p class="price">${product.price} ريال</p>
                                <a href="https://wa.me/9665XXXXXXXX?text=أريد استفسار عن: ${product.title}" class="buy-btn">
                                    اطلب عبر واتساب
                                </a>
                            </div>
                        `;
                    }
                }
            } catch (error) {
                console.error("خطأ:", error);
                document.getElementById('products-container').innerHTML = '<p>ابدأ بإضافة منتجاتك من لوحة التحكم لتظهر هنا.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadProducts);

        // كود خاص بتوجيه المستخدم بعد تسجيل الدخول في Identity
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.on("login", () => { document.location.href = "/admin/"; });
                }
            });
        }
    </script>
</body>
</html>
